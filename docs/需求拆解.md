# 需求拆解文档

## 项目概述

创建 npm 模板包 `@web.worker/create-astro-exe`，让用户可以通过 `npm create @web.worker/astro-exe` 命令快速初始化 Astro 项目模板。

---

## 功能模块

### 1. npm 包基础结构 ✅

**需求概要**：建立符合 npm create 规范的包结构和配置

**需求明细**：

- 包名：`@web.worker/create-astro-exe`
- 入口文件：`bin/create-astro-exe.js`
- 模块格式：ESM (type: "module")
- package.json 配置：bin 字段、engines、files 等
- 版本要求：Node.js >= 18

**验收标准**：

- ✅ package.json 配置正确
- ✅ bin 字段指向正确的可执行文件
- ✅ 支持 `npm create @web.worker/astro-exe` 命令

**边界条件**：

- 兼容 npm 7+ 版本
- 支持 yarn 和 pnpm

**优先级**：高
**状态**：已完成
**负责人**：悟空
**里程碑**：第一阶段 - 基础架构

---

### 2. CLI 脚手架核心功能 ✅

**需求概要**：实现项目创建的核心逻辑，包括目录创建、文件复制、依赖安装

**需求明细**：

- ✅ 项目名称参数解析和验证
- ✅ 目标目录创建与冲突检测
- ✅ 模板文件递归复制
- ✅ 模板变量替换（项目名、描述等）
- ✅ 自动执行 `npm install`
- ✅ Git 仓库初始化

**验收标准**：

- ✅ 支持 `npm create @web.worker/astro-exe my-project` 命令
- ✅ 生成完整的 Astro 项目目录
- ✅ 生成的项目可以执行 `npm run dev` 启动开发服务器

**边界条件**：

- 目录已存在时的处理策略
- 网络异常时的错误提示
- 权限不足时的友好提示
- 中断操作的清理机制

**优先级**：P0
**状态**：已完成
**负责人**：悟空
**里程碑**：第一阶段 - 基础框架

---

### 3. Astro 项目模板

**需求概要**：准备标准的 Astro 项目模板文件结构

**需求明细**：

- 基础 Astro 项目结构（src/、public/、astro.config.mjs）
- 预配置的 package.json 模板
- 基础页面和组件示例
- README.md 模板
- 基础的 CSS 样式文件
- 开发和构建脚本配置

**验收标准**：

- 输入：模板文件目录
- 输出：可运行的 Astro 项目
- 通过条件：项目包含完整的开发环境配置，可以正常构建和预览

**边界条件**：

- 模板文件的版本兼容性
- 依赖包的版本锁定策略
- 跨平台文件路径处理

**优先级**：P0
**状态**：待做
**负责人**：悟空
**里程碑**：第二阶段 - 模板完善

---

### 4. 交互式配置

**需求概要**：提供友好的交互式界面，让用户自定义项目配置

**需求明细**：

- 项目名称输入与验证
- 项目描述输入
- 作者信息配置
- 是否初始化 Git 仓库选择
- 是否安装依赖选择
- 进度显示和状态反馈

**验收标准**：

- 输入：用户交互选择
- 输出：个性化的项目配置
- 通过条件：所有配置项正确应用到生成的项目中

**边界条件**：

- 用户中断操作的处理
- 无效输入的验证和提示
- 默认值的合理设置

**优先级**：P1
**状态**：待做
**负责人**：悟空
**里程碑**：第二阶段 - 模板完善

---

### 5. 错误处理和用户体验

**需求概要**：完善的错误处理机制和友好的用户提示

**需求明细**：

- 详细的错误信息和解决建议
- 操作进度显示
- 成功完成后的使用指引
- 日志记录和调试信息
- 帮助文档和使用示例

**验收标准**：

- 输入：各种异常场景
- 输出：清晰的错误提示和解决方案
- 通过条件：用户能够根据提示解决问题或了解失败原因

**边界条件**：

- 网络连接异常
- 磁盘空间不足
- 权限限制
- 依赖安装失败

**优先级**：P1
**状态**：待做
**负责人**：悟空
**里程碑**：第三阶段 - 优化完善

---

## 技术约束

- Node.js >= 16
- 支持 Windows、macOS、Linux
- 使用 ESM 模块格式
- 依赖包尽量精简，避免过大的包体积

## 风险与备注

- **依赖版本兼容性**：需要定期更新 Astro 和相关依赖的版本
- **模板维护成本**：随着 Astro 版本更新，模板需要同步维护
- **网络依赖**：依赖安装过程需要网络连接，考虑离线场景的处理

## 交付物

- npm 包：`@web.worker/create-astro-exe`
- CLI 工具：支持 `npm create @web.worker/astro-exe` 命令
- 项目模板：完整的 Astro 项目结构
- 使用文档：README 和使用示例

---

## 迭代计划

### 第一阶段：基础框架（MVP）

- [x] 需求拆解和文档编写
- [ ] npm 包基础结构
- [ ] CLI 脚手架核心功能
- [ ] 基础模板文件

### 第二阶段：模板完善

- [ ] 交互式配置功能
- [ ] 模板内容丰富化
- [ ] 错误处理优化

### 第三阶段：优化完善

- [ ] 用户体验优化
- [ ] 性能优化
- [ ] 文档完善
- [ ] 发布到 npm

---

_最后更新：2024年12月_
